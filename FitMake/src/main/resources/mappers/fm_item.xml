<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fm.item">
	
<sql id="search">
	WHERE FM_ITEM_NAME LIKE '%'||#{keyword}||'%' 
	AND FM_CATEGORY_NO = #{cNo}
</sql>
	<resultMap type="itemDto" id="itemResultMap">
		<id column="FM_ITEM_NO" property="iNo"/>
		<result column="FM_CATEGORY_NO" property=	"cNo"/>
		<result column="FM_ITEM_NAME" property=		"iName"/>
		<result column="FM_ITEM_CALORY" property=	"iCalory"/>
		<result column="FM_ITEM_RAWPRICE" property=	"iRawprice"/>
		<result column="FM_ITEM_SELLPRICE" property="iSellprice"/>
		<result column="FM_ITEM_COUNT" property=	"iCount"/>
		<result column="FM_CALORY_GRADE" property=	"iCGrade"/>
		<result column="FM_ITEM_DETAIL" property=	"iOneDetail"/>
	</resultMap>
	
	<insert id="itemInsertOne" parameterType= "itemDto"
		useGeneratedKeys="true" keyProperty="iNo">
		<selectKey keyProperty="iNo" resultType="int" order="BEFORE">
			SELECT SEQ_FM_ITEM_NO.NEXTVAL
			FROM DUAL
		</selectKey>
			INSERT INTO FM_ITEM
			VALUE(FM_ITEM_NO, FM_ITEM_NAME, FM_ITEM_CALORY, FM_ITEM_RAWPRICE, FM_ITEM_SELLPRICE, FM_ITEM_COUNT
   				, FM_CATEGORY_NO, FM_CALORY_GRADE, FM_ITEM_DETAIL)
			VALUES(#{iNo}, #{iName}, ${iCalory}, 1000, #{iSellprice}, #{iCount}, #{cNo}, 2, #{iOneDetail})
			
	</insert>
	
	<select id="itemSelectList" parameterType="map"	resultMap="itemResultMap">
		SELECT PI.FM_ITEM_NO, PI.FM_ITEM_NAME, PI.FM_ITEM_SELLPRICE, PI.FM_ITEM_COUNT, PI.FM_CATEGORY_NO
		FROM(
			SELECT ROWNUM AS RNUM, I.FM_ITEM_NO, I.FM_ITEM_NAME, I.FM_ITEM_SELLPRICE, I.FM_ITEM_COUNT, I.FM_CATEGORY_NO
			FROM(
				SELECT FM_ITEM_NO, FM_ITEM_NAME, FM_ITEM_SELLPRICE, FM_ITEM_COUNT, FM_CATEGORY_NO
				FROM FM_ITEM
				<include refid="search"></include>
			)I
		)PI
		WHERE PI.RNUM BETWEEN #{start} AND #{end}
	</select>
	
	<select id="itemSelectListGold" parameterType="map"	resultMap="itemResultMap">
		SELECT PI.FM_ITEM_NO, PI.FM_ITEM_NAME, PI.FM_ITEM_SELLPRICE, PI.FM_ITEM_COUNT, PI.FM_CATEGORY_NO
		FROM(
			SELECT ROWNUM AS RNUM, I.FM_ITEM_NO, I.FM_ITEM_NAME, I.FM_ITEM_SELLPRICE, I.FM_ITEM_COUNT, I.FM_CATEGORY_NO
			FROM(
				SELECT FM_ITEM_NO, FM_ITEM_NAME, FM_ITEM_SELLPRICE, FM_ITEM_COUNT, FM_CATEGORY_NO
				FROM FM_ITEM
				<include refid="search"></include>
				ORDER BY FM_ITEM_SELLPRICE
			)I
		)PI
		WHERE PI.RNUM BETWEEN #{start} AND #{end}
		
	</select>
	
	<select id="itemSelectListReview" parameterType="map" resultMap="itemResultMap">
		SELECT PI.FM_ITEM_NO, PI.FM_ITEM_NAME, PI.FM_ITEM_SELLPRICE, PI.FM_ITEM_COUNT, PI.FM_CATEGORY_NO
		FROM(
			SELECT ROWNUM AS RNUM, I.FM_ITEM_NO, I.FM_ITEM_NAME, I.FM_ITEM_SELLPRICE, I.FM_ITEM_COUNT, I.FM_CATEGORY_NO
			FROM(
				SELECT FM_ITEM_NO, FM_ITEM_NAME, FM_ITEM_SELLPRICE, FM_ITEM_COUNT, FM_CATEGORY_NO
				FROM FM_ITEM
				<include refid="search"></include>
				ORDER BY FM_ITEM_COUNT DESC
			)I
		)PI
		WHERE PI.RNUM BETWEEN #{start} AND #{end}
		
		
	</select>
	
	<select id="itemSelectOne" parameterType="int"
		resultMap="itemResultMap">
		SELECT FM_ITEM_NO, FM_ITEM_NAME, FM_ITEM_SELLPRICE, FM_ITEM_COUNT, FM_CATEGORY_NO, FM_ITEM_DETAIL, FM_ITEM_CALORY
		FROM FM_ITEM
		WHERE FM_ITEM_NO = #{iNo}
	</select>
	
	<update id="itemUpdateOne" parameterType="itemDto">
		UPDATE FM_ITEM
		<set>
			<if test="iName != ''">FM_ITEM_NAME = #{iName},</if>
			<if test="iSellprice != ''">FM_ITEM_SELLPRICE = #{iSellprice},</if>
			<if test="iCount != ''">FM_ITEM_COUNT = #{iCount}</if>
		</set>
		WHERE FM_ITEM_NO = #{iNo}
	</update>
	
	<delete id="itemDeleteOne" parameterType="int">
		 DELETE FROM FM_ITEM
		 WHERE FM_ITEM_NO = #{value}
	</delete>
	
	
<!--  밑에는 아이템@@@@@@  -->
	
	<insert id="insertFile" parameterType="map">
		INSERT INTO FM_ITEM_IMG
		(FM_ITEM_IMG_NO, FM_ITEM_NO, FM_ITEM_IMG_NAME, FM_ITEM_STORED_IMG_NAME)
		VALUES
		(SEQ_FM_ITEM_IMG_NO.NEXTVAL, ${parentSeq}, #{original_file_name}, #{stored_file_name})
	</insert>
	
	<select id="fileSelectList" parameterType="int" resultType="map">
		SELECT FM_ITEM_IMG_NO, FM_ITEM_IMG_NAME, FM_ITEM_STORED_IMG_NAME
		FROM FM_ITEM_IMG
		WHERE FM_ITEM_NO = #{parentSeq}
	</select>
	
	<select id="fileSelectOne" parameterType="int" resultType="map">
		SELECT FM_ITEM_IMG_NO, FM_ITEM_IMG_NAME, FM_ITEM_STORED_IMG_NAME
		FROM FM_ITEM_IMG
		WHERE FM_ITEM_NO = #{value}
		
	</select>
	
	<delete id="fileDelete" parameterType="int">
		DELETE FROM FM_ITEM_IMG
		WHERE FM_ITEM_IMG_NO = ${value}
	</delete>
	
	
	
	<select id="itemSelectTotalItemCount" resultType="int" parameterType="map">
		SELECT COUNT(*)
		FROM FM_ITEM
		<include refid="search"></include>
	</select>
</mapper>